<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Solar System Explorer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Exo+2:wght@300;400;600&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Exo 2', sans-serif;
            overflow: hidden;
            background: #000;
            color: #fff;
            position: relative;
        }
        
        #canvas-container {
            width: 100vw;
            height: 100vh;
            position: relative;
        }
        
        .glow {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, rgba(25, 25, 112, 0.4) 0%, rgba(0, 0, 0, 0) 70%);
            pointer-events: none;
            z-index: 1;
        }
        
        .ui-panel {
            position: absolute;
            background: rgba(10, 10, 30, 0.85);
            border: 1px solid rgba(100, 200, 255, 0.3);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(15px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            z-index: 10;
            transition: all 0.3s ease;
        }
        
        .ui-panel:hover {
            box-shadow: 0 0 25px rgba(100, 200, 255, 0.3);
            border-color: rgba(100, 200, 255, 0.6);
        }
        
        #info-panel {
            top: 20px;
            left: 20px;
            width: 320px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        #info-panel h1 {
            font-family: 'Orbitron', sans-serif;
            font-weight: 900;
            font-size: 24px;
            margin-bottom: 15px;
            color: #4fc3f7;
            text-shadow: 0 0 10px rgba(79, 195, 247, 0.7);
        }
        
        #info-panel h2 {
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: 18px;
            margin-bottom: 10px;
            color: #64b5f6;
        }
        
        #info-panel p {
            margin-bottom: 12px;
            font-size: 14px;
            line-height: 1.5;
            color: #e1f5fe;
        }
        
        #info-panel .fact-list {
            margin-top: 10px;
            padding-left: 20px;
        }
        
        #info-panel .fact-list li {
            margin-bottom: 8px;
            font-size: 13px;
            color: #b3e5fc;
        }
        
        #controls {
            bottom: 20px;
            left: 20px;
            width: 300px;
        }
        
        .control-group {
            margin-bottom: 15px;
        }
        
        .control-group h3 {
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: 14px;
            margin-bottom: 8px;
            color: #81d4fa;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .control-btn {
            background: linear-gradient(135deg, rgba(33, 150, 243, 0.2), rgba(3, 169, 244, 0.2));
            border: 1px solid rgba(100, 200, 255, 0.4);
            color: #fff;
            padding: 8px 15px;
            margin: 5px 5px 5px 0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Exo 2', sans-serif;
            font-weight: 600;
            font-size: 13px;
            display: inline-block;
        }
        
        .control-btn:hover {
            background: linear-gradient(135deg, rgba(33, 150, 243, 0.4), rgba(3, 169, 244, 0.4));
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.3);
        }
        
        .control-btn.active {
            background: linear-gradient(135deg, rgba(3, 169, 244, 0.5), rgba(0, 188, 212, 0.5));
            border-color: #00bcd4;
        }
        
        #speed-control {
            margin-top: 15px;
        }
        
        #speed-slider {
            width: 100%;
            margin-top: 8px;
            height: 6px;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.1);
            outline: none;
            -webkit-appearance: none;
        }
        
        #speed-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: linear-gradient(135deg, #29b6f6, #03a9f4);
            cursor: pointer;
            box-shadow: 0 0 10px rgba(41, 182, 246, 0.7);
        }
        
        #celestial-selector {
            top: 20px;
            right: 20px;
            width: 220px;
            max-height: 85vh;
            overflow-y: auto;
            transition: all 0.3s ease;
        }
        
        #celestial-selector.hidden {
            opacity: 0;
            pointer-events: none;
            transform: translateX(20px);
        }
        
        .celestial-option {
            padding: 12px 15px;
            margin: 8px 0;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            border-left: 3px solid transparent;
            display: flex;
            align-items: center;
        }
        
        .celestial-option:hover {
            background: rgba(79, 195, 247, 0.15);
            transform: translateX(5px);
        }
        
        .celestial-option.active {
            background: rgba(79, 195, 247, 0.25);
            border-left-color: #4fc3f7;
            box-shadow: 0 0 15px rgba(79, 195, 247, 0.3);
        }
        
        .planet-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            margin-right: 12px;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
        }
        
        #distance-tool {
            bottom: 20px;
            right: 20px;
            width: 280px;
            display: none;
        }
        
        #distance-tool.active {
            display: block;
        }
        
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: 28px;
            color: #4fc3f7;
            text-shadow: 0 0 20px rgba(79, 195, 247, 0.8);
            z-index: 100;
        }
        
        .loading::after {
            content: '...';
            animation: dots 1.5s steps(4, end) infinite;
        }
        
        @keyframes dots {
            0%, 20% { content: ''; }
            40% { content: '.'; }
            60% { content: '..'; }
            80%, 100% { content: '...'; }
        }
        
        #minimap {
            position: absolute;
            bottom: 20px;
            left: 340px;
            width: 200px;
            height: 200px;
            background: rgba(10, 10, 30, 0.8);
            border: 1px solid rgba(100, 200, 255, 0.3);
            border-radius: 10px;
            overflow: hidden;
            z-index: 10;
        }
        
        #minimap canvas {
            width: 100%;
            height: 100%;
        }
        
        #time-display {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: 18px;
            color: #81d4fa;
            text-shadow: 0 0 10px rgba(129, 212, 250, 0.7);
            z-index: 10;
            background: rgba(10, 10, 30, 0.7);
            padding: 10px 20px;
            border-radius: 30px;
            border: 1px solid rgba(100, 200, 255, 0.3);
        }
        
        #educational-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(10, 10, 30, 0.95);
            border: 1px solid rgba(100, 200, 255, 0.5);
            border-radius: 15px;
            padding: 25px;
            max-width: 600px;
            display: none;
            z-index: 100;
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.8);
        }
        
        #educational-overlay.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
            to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }
        
        #educational-overlay h3 {
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: 24px;
            margin-bottom: 15px;
            color: #4fc3f7;
            text-shadow: 0 0 10px rgba(79, 195, 247, 0.7);
        }
        
        #educational-overlay p {
            margin-bottom: 15px;
            line-height: 1.6;
            font-size: 15px;
            color: #e1f5fe;
        }
        
        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #fff;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .close-btn:hover {
            background: rgba(244, 67, 54, 0.3);
            border-color: #f44336;
            transform: rotate(90deg);
        }
        
        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(100, 200, 255, 0.3);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(100, 200, 255, 0.5);
        }
        
        /* Planet glow effects */
        .planet-glow {
            position: absolute;
            border-radius: 50%;
            pointer-events: none;
            z-index: 5;
        }
        
        /* Responsive design */
        @media (max-width: 768px) {
            .ui-panel {
                width: calc(100% - 40px);
                max-width: none;
            }
            
            #info-panel {
                top: auto;
                bottom: 20px;
                left: 20px;
                right: 20px;
                max-height: 40vh;
            }
            
            #controls {
                top: 20px;
                left: 20px;
                bottom: auto;
                width: calc(100% - 40px);
            }
            
            #celestial-selector {
                display: none;
            }
            
            #minimap {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div id="canvas-container">
        <div class="loading">Initializing Solar System</div>
        <div class="glow"></div>
    </div>
    
    <div id="time-display">Simulation Time: Day 0</div>
    
    <div id="info-panel" class="ui-panel">
        <h1>Solar System Explorer</h1>
        <p>Navigate through our cosmic neighborhood with realistic physics and stunning visuals.</p>
        <p id="selected-info">Select a celestial body to view detailed information.</p>
    </div>
    
    <div id="controls" class="ui-panel">
        <div class="control-group">
            <h3>Navigation</h3>
            <button class="control-btn" id="play-pause">Pause</button>
            <button class="control-btn" id="reset-view">Reset View</button>
        </div>
        
        <div class="control-group">
            <h3>Display Options</h3>
            <button class="control-btn active" id="toggle-orbits">Orbits</button>
            <button class="control-btn active" id="toggle-labels">Labels</button>
            <button class="control-btn" id="toggle-atmospheres">Atmospheres</button>
            <button class="control-btn" id="toggle-stars">Starfield</button>
        </div>
        
        <div class="control-group">
            <h3>Tools</h3>
            <button class="control-btn" id="distance-measure">Distance Tool</button>
            <button class="control-btn" id="explore-mode">Explore Mode</button>
            <button class="control-btn" id="toggle-selector">Toggle Selector</button>
        </div>
        
        <div id="speed-control" class="control-group">
            <h3>Simulation Speed: <span id="speed-value">1</span>x</h3>
            <input type="range" id="speed-slider" min="0" max="20" step="0.1" value="1">
        </div>
    </div>
    
    <div id="celestial-selector" class="ui-panel">
        <h3>Celestial Bodies</h3>
        <div class="celestial-option" data-body="sun">
            <div class="planet-icon" style="background: radial-gradient(circle, #ffff00, #ff9900);"></div>
            Sun
        </div>
        <div class="celestial-option" data-body="mercury">
            <div class="planet-icon" style="background: radial-gradient(circle, #b0b0b0, #808080);"></div>
            Mercury
        </div>
        <div class="celestial-option" data-body="venus">
            <div class="planet-icon" style="background: radial-gradient(circle, #ffd966, #cc9900);"></div>
            Venus
        </div>
        <div class="celestial-option" data-body="earth">
            <div class="planet-icon" style="background: radial-gradient(circle, #3399ff, #0066cc);"></div>
            Earth
        </div>
        <div class="celestial-option" data-body="moon">
            <div class="planet-icon" style="background: radial-gradient(circle, #f0f0f0, #c0c0c0);"></div>
            Moon
        </div>
        <div class="celestial-option" data-body="mars">
            <div class="planet-icon" style="background: radial-gradient(circle, #ff6666, #cc0000);"></div>
            Mars
        </div>
        <div class="celestial-option" data-body="jupiter">
            <div class="planet-icon" style="background: radial-gradient(circle, #ffcc99, #cc9966);"></div>
            Jupiter
        </div>
        <div class="celestial-option" data-body="saturn">
            <div class="planet-icon" style="background: radial-gradient(circle, #ffcc99, #cc9933);"></div>
            Saturn
        </div>
        <div class="celestial-option" data-body="uranus">
            <div class="planet-icon" style="background: radial-gradient(circle, #66ccff, #3399cc);"></div>
            Uranus
        </div>
        <div class="celestial-option" data-body="neptune">
            <div class="planet-icon" style="background: radial-gradient(circle, #3366ff, #0033cc);"></div>
            Neptune
        </div>
        <div class="celestial-option" data-body="pluto">
            <div class="planet-icon" style="background: radial-gradient(circle, #e6ccff, #b366ff);"></div>
            Pluto
        </div>
    </div>
    
    <div id="minimap">
        <canvas id="minimap-canvas"></canvas>
    </div>
    
    <div id="distance-tool" class="ui-panel">
        <h3>Distance Measurement</h3>
        <p>Click on two celestial bodies to measure the distance between them.</p>
        <p id="distance-result"></p>
        <button class="control-btn" id="clear-distance">Clear Measurement</button>
    </div>
    
    <div id="educational-overlay" class="ui-panel">
        <button class="close-btn" id="close-overlay">×</button>
        <h3 id="overlay-title">Orbital Mechanics</h3>
        <div id="overlay-content"></div>
    </div>

    <script>
        // Global variables
        let scene, camera, renderer, controls;
        let celestialBodies = {};
        let orbits = {};
        let labels = {};
        let isPaused = false;
        let simulationSpeed = 1;
        let showOrbits = true;
        let showLabels = true;
        let showAtmospheres = true;
        let showStars = true;
        let distanceMode = false;
        let exploreMode = false;
        let selectedBodies = [];
        let raycaster, mouse;
        let minimapRenderer, minimapCamera, minimapScene;
        let simulationDay = 0;
        let stars;
        
        // Celestial body data with all planets
        const celestialData = {
            sun: {
                name: "Sun",
                radius: 12,
                color: 0xffff00,
                emissive: 0xffff33,
                description: "The Sun is the star at the center of our Solar System. It's a nearly perfect sphere of hot plasma, with internal convective motion that generates a magnetic field.",
                facts: [
                    "Diameter: 1.39 million km",
                    "Surface Temperature: 5,500°C",
                    "Core Temperature: 15 million°C",
                    "Age: 4.6 billion years",
                    "Mass: 1.989 × 10^30 kg"
                ],
                hasAtmosphere: false
            },
            mercury: {
                name: "Mercury",
                radius: 1.2,
                color: 0xb0b0b0,
                distance: 20,
                orbitalPeriod: 88,
                rotationPeriod: 58.6,
                description: "Mercury is the smallest and innermost planet in the Solar System. It has no atmosphere to retain heat, leading to extreme temperature variations.",
                facts: [
                    "Diameter: 4,879 km",
                    "Distance from Sun: 57.9 million km",
                    "Orbital Period: 88 Earth days",
                    "Day Length: 58.6 Earth days",
                    "Temperature Range: -173°C to 427°C"
                ],
                hasAtmosphere: false
            },
            venus: {
                name: "Venus",
                radius: 2.2,
                color: 0xffd966,
                distance: 28,
                orbitalPeriod: 225,
                rotationPeriod: 243,
                description: "Venus is the second planet from the Sun and the hottest planet in our Solar System due to its thick atmosphere and greenhouse effect.",
                facts: [
                    "Diameter: 12,104 km",
                    "Distance from Sun: 108.2 million km",
                    "Orbital Period: 225 Earth days",
                    "Day Length: 243 Earth days",
                    "Surface Temperature: 462°C"
                ],
                hasAtmosphere: true,
                atmosphereColor: 0xffd966
            },
            earth: {
                name: "Earth",
                radius: 2.5,
                color: 0x3399ff,
                distance: 38,
                orbitalPeriod: 365,
                rotationPeriod: 1,
                description: "Earth is the third planet from the Sun and the only astronomical object known to harbor life. About 71% of Earth's surface is covered with water.",
                facts: [
                    "Diameter: 12,742 km",
                    "Distance from Sun: 149.6 million km",
                    "Orbital Period: 365.25 days",
                    "Rotation Period: 24 hours",
                    "Surface Water: 71%"
                ],
                hasAtmosphere: true,
                atmosphereColor: 0x87ceeb
            },
            moon: {
                name: "Moon",
                radius: 0.7,
                color: 0xf0f0f0,
                distance: 6,
                orbitalPeriod: 27.3,
                rotationPeriod: 27.3,
                description: "The Moon is Earth's only natural satellite. It is the fifth largest moon in the Solar System and the largest among planetary satellites relative to the size of its host planet.",
                facts: [
                    "Diameter: 3,474 km",
                    "Distance from Earth: 384,400 km",
                    "Orbital Period: 27.3 days",
                    "Surface Gravity: 1.62 m/s²",
                    "Formation: 4.5 billion years ago"
                ],
                hasAtmosphere: false
            },
            mars: {
                name: "Mars",
                radius: 1.8,
                color: 0xff6666,
                distance: 50,
                orbitalPeriod: 687,
                rotationPeriod: 1.03,
                description: "Mars is the fourth planet from the Sun and the second-smallest planet in the Solar System. Often referred to as the 'Red Planet' due to its reddish appearance.",
                facts: [
                    "Diameter: 6,779 km",
                    "Distance from Sun: 227.9 million km",
                    "Orbital Period: 687 days",
                    "Day Length: 24.6 hours",
                    "Moons: 2 (Phobos and Deimos)"
                ],
                hasAtmosphere: true,
                atmosphereColor: 0xff9999
            },
            jupiter: {
                name: "Jupiter",
                radius: 6,
                color: 0xffcc99,
                distance: 75,
                orbitalPeriod: 4333,
                rotationPeriod: 0.41,
                description: "Jupiter is the fifth planet from the Sun and the largest in the Solar System. It is a gas giant with a mass more than two and a half times that of all the other planets combined.",
                facts: [
                    "Diameter: 139,820 km",
                    "Distance from Sun: 778.5 million km",
                    "Orbital Period: 11.86 Earth years",
                    "Day Length: 9.9 hours",
                    "Moons: 79 known moons"
                ],
                hasAtmosphere: true,
                atmosphereColor: 0xffddaa
            },
            saturn: {
                name: "Saturn",
                radius: 5,
                color: 0xffcc99,
                distance: 100,
                orbitalPeriod: 10759,
                rotationPeriod: 0.45,
                description: "Saturn is the sixth planet from the Sun and the second-largest in the Solar System. It is a gas giant with an average radius about nine times that of Earth.",
                facts: [
                    "Diameter: 116,460 km",
                    "Distance from Sun: 1.43 billion km",
                    "Orbital Period: 29.46 Earth years",
                    "Day Length: 10.7 hours",
                    "Rings: Prominent ring system"
                ],
                hasAtmosphere: true,
                atmosphereColor: 0xffeecc,
                hasRings: true
            },
            uranus: {
                name: "Uranus",
                radius: 3.5,
                color: 0x66ccff,
                distance: 130,
                orbitalPeriod: 30687,
                rotationPeriod: 0.72,
                description: "Uranus is the seventh planet from the Sun. It has the third-largest planetary radius and fourth-largest planetary mass in the Solar System.",
                facts: [
                    "Diameter: 50,724 km",
                    "Distance from Sun: 2.87 billion km",
                    "Orbital Period: 84 Earth years",
                    "Day Length: 17.2 hours",
                    "Axial Tilt: 97.77 degrees"
                ],
                hasAtmosphere: true,
                atmosphereColor: 0xaaddff
            },
            neptune: {
                name: "Neptune",
                radius: 3.4,
                color: 0x3366ff,
                distance: 160,
                orbitalPeriod: 60190,
                rotationPeriod: 0.67,
                description: "Neptune is the eighth and farthest-known Solar planet from the Sun. It is the fourth-largest planet by diameter and the third-most-massive planet.",
                facts: [
                    "Diameter: 49,244 km",
                    "Distance from Sun: 4.5 billion km",
                    "Orbital Period: 164.8 Earth years",
                    "Day Length: 16.1 hours",
                    "Wind Speeds: Up to 2,100 km/h"
                ],
                hasAtmosphere: true,
                atmosphereColor: 0x5588ff
            },
            pluto: {
                name: "Pluto",
                radius: 1,
                color: 0xe6ccff,
                distance: 190,
                orbitalPeriod: 90560,
                rotationPeriod: 6.39,
                description: "Pluto is a dwarf planet in the Kuiper belt. It was considered the ninth planet from the Sun until 2006 when it was reclassified as a dwarf planet.",
                facts: [
                    "Diameter: 2,377 km",
                    "Distance from Sun: 5.9 billion km",
                    "Orbital Period: 248 Earth years",
                    "Day Length: 6.4 Earth days",
                    "Moons: 5 known moons"
                ],
                hasAtmosphere: false
            }
        };
        
        // Initialize the scene
        function init() {
            // Create scene
            scene = new THREE.Scene();
            scene.fog = new THREE.FogExp2(0x000000, 0.00000025);
            
            // Create camera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 10000);
            camera.position.set(0, 50, 100);
            
            // Create renderer
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            document.getElementById('canvas-container').appendChild(renderer.domElement);
            
            // Remove loading message
            document.querySelector('.loading').style.display = 'none';
            
            // Add controls
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.minDistance = 10;
            controls.maxDistance = 500;
            
            // Add ambient light
            const ambientLight = new THREE.AmbientLight(0x333333);
            scene.add(ambientLight);
            
            // Add point light for the Sun
            const sunLight = new THREE.PointLight(0xffffff, 2, 1000);
            sunLight.castShadow = true;
            sunLight.shadow.mapSize.width = 2048;
            sunLight.shadow.mapSize.height = 2048;
            scene.add(sunLight);
            
            // Create starfield
            createStarfield();
            
            // Create celestial bodies
            createCelestialBodies();
            
            // Create orbits
            createOrbits();
            
            // Create labels
            createLabels();
            
            // Initialize minimap
            initMinimap();
            
            // Initialize raycaster for mouse interaction
            raycaster = new THREE.Raycaster();
            mouse = new THREE.Vector2();
            
            // Add event listeners
            window.addEventListener('resize', onWindowResize);
            renderer.domElement.addEventListener('click', onMouseClick);
            document.getElementById('play-pause').addEventListener('click', togglePlayPause);
            document.getElementById('reset-view').addEventListener('click', resetView);
            document.getElementById('toggle-orbits').addEventListener('click', toggleOrbits);
            document.getElementById('toggle-labels').addEventListener('click', toggleLabels);
            document.getElementById('toggle-atmospheres').addEventListener('click', toggleAtmospheres);
            document.getElementById('toggle-stars').addEventListener('click', toggleStars);
            document.getElementById('distance-measure').addEventListener('click', toggleDistanceTool);
            document.getElementById('clear-distance').addEventListener('click', clearDistance);
            document.getElementById('explore-mode').addEventListener('click', toggleExploreMode);
            document.getElementById('toggle-selector').addEventListener('click', toggleCelestialSelector);
            document.getElementById('speed-slider').addEventListener('input', updateSimulationSpeed);
            document.getElementById('close-overlay').addEventListener('click', closeEducationalOverlay);
            
            // Add celestial body selection
            document.querySelectorAll('.celestial-option').forEach(option => {
                option.addEventListener('click', function() {
                    selectCelestialBody(this.dataset.body);
                    
                    // Update active state
                    document.querySelectorAll('.celestial-option').forEach(opt => {
                        opt.classList.remove('active');
                    });
                    this.classList.add('active');
                });
            });
            
            // Start animation
            animate();
        }
        
        // Create starfield
        function createStarfield() {
            const starsGeometry = new THREE.BufferGeometry();
            const starsMaterial = new THREE.PointsMaterial({
                color: 0xffffff,
                size: 0.7,
                transparent: true,
                opacity: 0.8,
                sizeAttenuation: true
            });
            
            const starsVertices = [];
            for (let i = 0; i < 20000; i++) {
                const x = (Math.random() - 0.5) * 2000;
                const y = (Math.random() - 0.5) * 2000;
                const z = (Math.random() - 0.5) * 2000;
                starsVertices.push(x, y, z);
            }
            
            starsGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starsVertices, 3));
            stars = new THREE.Points(starsGeometry, starsMaterial);
            scene.add(stars);
        }
        
        // Create celestial bodies
        function createCelestialBodies() {
            // Create Sun
            const sunGeometry = new THREE.SphereGeometry(celestialData.sun.radius, 64, 64);
            const sunMaterial = new THREE.MeshBasicMaterial({
                color: celestialData.sun.color,
                emissive: celestialData.sun.emissive,
                emissiveIntensity: 1
            });
            const sunMesh = new THREE.Mesh(sunGeometry, sunMaterial);
            sunMesh.userData = { type: 'sun', data: celestialData.sun };
            scene.add(sunMesh);
            celestialBodies.sun = sunMesh;
            
            // Create Sun glow
            const sunGlowGeometry = new THREE.SphereGeometry(celestialData.sun.radius * 1.5, 32, 32);
            const sunGlowMaterial = new THREE.MeshBasicMaterial({
                color: 0xffff00,
                transparent: true,
                opacity: 0.3
            });
            const sunGlow = new THREE.Mesh(sunGlowGeometry, sunGlowMaterial);
            sunMesh.add(sunGlow);
            
            // Create planets
            Object.keys(celestialData).forEach(key => {
                if (key === 'sun' || key === 'moon') return;
                
                const data = celestialData[key];
                const planetGroup = new THREE.Group();
                scene.add(planetGroup);
                
                // Create planet
                const planetGeometry = new THREE.SphereGeometry(data.radius, 64, 64);
                const planetMaterial = new THREE.MeshPhongMaterial({
                    color: data.color,
                    shininess: 10,
                    specular: 0x222222
                });
                const planetMesh = new THREE.Mesh(planetGeometry, planetMaterial);
                planetMesh.position.x = data.distance;
                planetMesh.castShadow = true;
                planetMesh.receiveShadow = true;
                planetMesh.userData = { type: key, data: data };
                planetGroup.add(planetMesh);
                
                // Create atmosphere if planet has one
                if (data.hasAtmosphere && showAtmospheres) {
                    const atmosphereGeometry = new THREE.SphereGeometry(data.radius * 1.1, 32, 32);
                    const atmosphereMaterial = new THREE.MeshBasicMaterial({
                        color: data.atmosphereColor,
                        transparent: true,
                        opacity: 0.2,
                        side: THREE.BackSide
                    });
                    const atmosphere = new THREE.Mesh(atmosphereGeometry, atmosphereMaterial);
                    planetMesh.add(atmosphere);
                }
                
                // Create rings for Saturn
                if (data.hasRings) {
                    const ringGeometry = new THREE.RingGeometry(data.radius * 1.5, data.radius * 2.5, 64);
                    const ringMaterial = new THREE.MeshBasicMaterial({
                        color: 0xffeecc,
                        side: THREE.DoubleSide,
                        transparent: true,
                        opacity: 0.8
                    });
                    const rings = new THREE.Mesh(ringGeometry, ringMaterial);
                    rings.rotation.x = Math.PI / 2;
                    planetMesh.add(rings);
                }
                
                celestialBodies[key] = { mesh: planetMesh, group: planetGroup };
            });
            
            // Create Moon (orbiting Earth)
            const moonGroup = new THREE.Group();
            moonGroup.position.copy(celestialBodies.earth.mesh.position);
            celestialBodies.earth.group.add(moonGroup);
            
            const moonGeometry = new THREE.SphereGeometry(celestialData.moon.radius, 32, 32);
            const moonMaterial = new THREE.MeshPhongMaterial({
                color: celestialData.moon.color,
                shininess: 5
            });
            const moonMesh = new THREE.Mesh(moonGeometry, moonMaterial);
            moonMesh.position.x = celestialData.moon.distance;
            moonMesh.castShadow = true;
            moonMesh.receiveShadow = true;
            moonMesh.userData = { type: 'moon', data: celestialData.moon };
            moonGroup.add(moonMesh);
            
            celestialBodies.moon = { mesh: moonMesh, group: moonGroup };
        }
        
        // Create orbits
        function createOrbits() {
            Object.keys(celestialData).forEach(key => {
                if (key === 'sun' || key === 'moon') return;
                
                const data = celestialData[key];
                const orbitGeometry = new THREE.BufferGeometry();
                const orbitPoints = [];
                
                for (let i = 0; i <= 128; i++) {
                    const theta = (i / 128) * Math.PI * 2;
                    orbitPoints.push(new THREE.Vector3(
                        Math.cos(theta) * data.distance,
                        0,
                        Math.sin(theta) * data.distance
                    ));
                }
                
                orbitGeometry.setFromPoints(orbitPoints);
                const orbitMaterial = new THREE.LineBasicMaterial({ 
                    color: data.color,
                    transparent: true,
                    opacity: 0.3
                });
                const orbit = new THREE.Line(orbitGeometry, orbitMaterial);
                scene.add(orbit);
                orbits[key] = orbit;
            });
            
            // Moon orbit (around Earth)
            const moonOrbitGeometry = new THREE.BufferGeometry();
            const moonOrbitPoints = [];
            
            for (let i = 0; i <= 64; i++) {
                const theta = (i / 64) * Math.PI * 2;
                moonOrbitPoints.push(new THREE.Vector3(
                    Math.cos(theta) * celestialData.moon.distance,
                    0,
                    Math.sin(theta) * celestialData.moon.distance
                ));
            }
            
            moonOrbitGeometry.setFromPoints(moonOrbitPoints);
            const moonOrbitMaterial = new THREE.LineBasicMaterial({ 
                color: 0xf0f0f0,
                transparent: true,
                opacity: 0.3
            });
            const moonOrbit = new THREE.Line(moonOrbitGeometry, moonOrbitMaterial);
            celestialBodies.moon.group.add(moonOrbit);
            orbits.moon = moonOrbit;
        }
        
        // Create labels
        function createLabels() {
            Object.keys(celestialData).forEach(key => {
                const data = celestialData[key];
                const label = document.createElement('div');
                label.className = 'celestial-label';
                label.textContent = data.name;
                label.style.position = 'absolute';
                label.style.color = '#ffffff';
                label.style.padding = '4px 8px';
                label.style.backgroundColor = 'rgba(0,0,0,0.7)';
                label.style.borderRadius = '4px';
                label.style.fontSize = '12px';
                label.style.fontWeight = '600';
                label.style.pointerEvents = 'none';
                label.style.border = `1px solid ${data.color.toString(16)}`;
                label.style.boxShadow = `0 0 10px ${data.color.toString(16)}`;
                document.body.appendChild(label);
                
                let targetObject;
                if (key === 'sun') {
                    targetObject = celestialBodies.sun;
                } else if (key === 'moon') {
                    targetObject = celestialBodies.moon.mesh;
                } else {
                    targetObject = celestialBodies[key].mesh;
                }
                
                labels[key] = { element: label, object: targetObject };
            });
        }
        
        // Initialize minimap
        function initMinimap() {
            const minimapCanvas = document.getElementById('minimap-canvas');
            minimapRenderer = new THREE.WebGLRenderer({ canvas: minimapCanvas, antialias: true });
            minimapRenderer.setSize(200, 200);
            
            minimapScene = new THREE.Scene();
            minimapCamera = new THREE.OrthographicCamera(-150, 150, 150, -150, 1, 1000);
            minimapCamera.position.set(0, 200, 0);
            minimapCamera.lookAt(0, 0, 0);
            
            // Add simplified versions of celestial bodies to minimap
            Object.keys(celestialData).forEach(key => {
                const data = celestialData[key];
                const size = key === 'sun' ? 8 : (data.radius / 2);
                
                const geometry = new THREE.SphereGeometry(size, 16, 16);
                const material = new THREE.MeshBasicMaterial({ color: data.color });
                const mesh = new THREE.Mesh(geometry, material);
                
                if (key === 'sun') {
                    minimapScene.add(mesh);
                } else if (key === 'moon') {
                    // Moon will be handled separately
                } else {
                    mesh.position.x = data.distance;
                    minimapScene.add(mesh);
                }
            });
            
            // Add orbits to minimap
            Object.keys(celestialData).forEach(key => {
                if (key === 'sun' || key === 'moon') return;
                
                const data = celestialData[key];
                const orbitGeometry = new THREE.BufferGeometry();
                const orbitPoints = [];
                
                for (let i = 0; i <= 64; i++) {
                    const theta = (i / 64) * Math.PI * 2;
                    orbitPoints.push(new THREE.Vector3(
                        Math.cos(theta) * data.distance,
                        0,
                        Math.sin(theta) * data.distance
                    ));
                }
                
                orbitGeometry.setFromPoints(orbitPoints);
                const orbitMaterial = new THREE.LineBasicMaterial({ 
                    color: data.color,
                    transparent: true,
                    opacity: 0.5
                });
                const orbit = new THREE.Line(orbitGeometry, orbitMaterial);
                minimapScene.add(orbit);
            });
        }
        
        // Update minimap
        function updateMinimap() {
            // Update planet positions in minimap
            Object.keys(celestialData).forEach(key => {
                if (key === 'sun' || key === 'moon') return;
                
                const body = celestialBodies[key];
                if (body && body.group) {
                    const angle = body.group.rotation.y;
                    const distance = celestialData[key].distance;
                    
                    minimapScene.children.forEach(child => {
                        if (child.material && child.material.color.getHex() === celestialData[key].color) {
                            child.position.x = Math.cos(angle) * distance;
                            child.position.z = Math.sin(angle) * distance;
                        }
                    });
                }
            });
            
            minimapRenderer.render(minimapScene, minimapCamera);
        }
        
        // Update label positions
        function updateLabels() {
            if (!showLabels) {
                Object.values(labels).forEach(label => {
                    label.element.style.display = 'none';
                });
                return;
            }
            
            Object.values(labels).forEach(label => {
                label.element.style.display = 'block';
                
                // Get the object's world position
                const vector = new THREE.Vector3();
                label.object.getWorldPosition(vector);
                
                // Project to 2D screen coordinates
                vector.project(camera);
                
                // Convert to screen coordinates
                const x = (vector.x * 0.5 + 0.5) * window.innerWidth;
                const y = (-(vector.y * 0.5) + 0.5) * window.innerHeight;
                
                // Update label position
                label.element.style.left = `${x}px`;
                label.element.style.top = `${y}px`;
                
                // Hide label if behind camera
                if (vector.z > 1) {
                    label.element.style.display = 'none';
                }
            });
        }
        
        // Animation loop
        function animate() {
            requestAnimationFrame(animate);
            
            if (!isPaused) {
                // Update simulation time
                simulationDay += simulationSpeed * 0.01;
                document.getElementById('time-display').textContent = 
                    `Simulation Time: Day ${Math.floor(simulationDay)}`;
                
                // Rotate celestial bodies
                celestialBodies.sun.rotation.y += 0.001 * simulationSpeed;
                
                Object.keys(celestialData).forEach(key => {
                    if (key === 'sun' || key === 'moon') return;
                    
                    const body = celestialBodies[key];
                    if (body && body.mesh) {
                        // Rotate planet
                        body.mesh.rotation.y += (0.01 / celestialData[key].rotationPeriod) * simulationSpeed;
                        
                        // Orbit planet
                        body.group.rotation.y += (0.01 / celestialData[key].orbitalPeriod) * 365 * simulationSpeed;
                    }
                });
                
                // Moon orbit
                if (celestialBodies.moon && celestialBodies.moon.group) {
                    celestialBodies.moon.mesh.rotation.y += 0.005 * simulationSpeed;
                    celestialBodies.moon.group.rotation.y += (0.01 / celestialData.moon.orbitalPeriod) * 365 * simulationSpeed;
                }
                
                // Rotate starfield slowly
                if (stars) {
                    stars.rotation.y += 0.0001 * simulationSpeed;
                }
            }
            
            // Update controls
            controls.update();
            
            // Update labels
            updateLabels();
            
            // Update minimap
            updateMinimap();
            
            // Render scene
            renderer.render(scene, camera);
        }
        
        // Handle window resize
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
        
        // Handle mouse click
        function onMouseClick(event) {
            // Calculate mouse position in normalized device coordinates
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            
            // Update the picking ray with the camera and mouse position
            raycaster.setFromCamera(mouse, camera);
            
            // Calculate objects intersecting the picking ray
            const intersects = raycaster.intersectObjects(Object.values(celestialBodies).map(b => b.mesh || b));
            
            if (intersects.length > 0) {
                const clickedObject = intersects[0].object;
                
                if (distanceMode) {
                    // Add to selected bodies for distance measurement
                    if (!selectedBodies.includes(clickedObject)) {
                        selectedBodies.push(clickedObject);
                        
                        if (selectedBodies.length === 2) {
                            calculateDistance();
                        }
                    }
                } else {
                    // Hide celestial selector when a celestial body is clicked
                    document.getElementById('celestial-selector').classList.add('hidden');
                    
                    // Select celestial body
                    selectCelestialBody(clickedObject.userData.type);
                    
                    // Update active state in selector
                    document.querySelectorAll('.celestial-option').forEach(opt => {
                        opt.classList.remove('active');
                        if (opt.dataset.body === clickedObject.userData.type) {
                            opt.classList.add('active');
                        }
                    });
                }
            }
        }
        
        // Select celestial body
        function selectCelestialBody(bodyType) {
            const data = celestialData[bodyType];
            if (!data) return;
            
            // Update info panel
            let infoHTML = `<h2>${data.name}</h2>`;
            infoHTML += `<p>${data.description}</p>`;
            infoHTML += `<ul class="fact-list">`;
            data.facts.forEach(fact => {
                infoHTML += `<li>${fact}</li>`;
            });
            infoHTML += `</ul>`;
            
            document.getElementById('selected-info').innerHTML = infoHTML;
            
            // Focus camera on selected body
            let targetObject;
            if (bodyType === 'sun') {
                targetObject = celestialBodies.sun;
            } else if (bodyType === 'moon') {
                targetObject = celestialBodies.moon.mesh;
            } else {
                targetObject = celestialBodies[bodyType].mesh;
            }
            
            if (targetObject) {
                const distance = data.radius * (exploreMode ? 3 : 8);
                const position = new THREE.Vector3();
                targetObject.getWorldPosition(position);
                
                // Animate camera to new position
                const startPosition = camera.position.clone();
                const endPosition = new THREE.Vector3(
                    position.x + distance,
                    position.y + distance,
                    position.z + distance
                );
                
                // Simple animation
                let progress = 0;
                const animateCamera = () => {
                    progress += 0.05;
                    if (progress <= 1) {
                        camera.position.lerpVectors(startPosition, endPosition, progress);
                        controls.target.copy(position);
                        requestAnimationFrame(animateCamera);
                    }
                };
                animateCamera();
                
                // Show educational overlay
                if (bodyType === 'earth') {
                    showEducationalOverlay('Earth - Our Home Planet', `
                        <p>Earth is the only known planet to harbor life. Its unique position in the habitable zone, 
                        liquid water, and protective atmosphere create the perfect conditions for life as we know it.</p>
                        <p>The Earth's atmosphere is composed of 78% nitrogen, 21% oxygen, and trace amounts of other gases. 
                        This atmosphere protects us from harmful solar radiation and helps regulate temperature.</p>
                        <p>Earth's magnetic field, generated by its molten iron core, extends thousands of kilometers into space 
                        and protects us from the solar wind.</p>
                    `);
                } else if (bodyType === 'saturn') {
                    showEducationalOverlay('Saturn - The Ringed Giant', `
                        <p>Saturn's rings are one of the most spectacular sights in our solar system. They are made up of 
                        billions of particles of ice and rock, ranging in size from tiny grains to large boulders.</p>
                        <p>The rings are incredibly thin - only about 10 meters thick in most places - but extend up to 
                        282,000 kilometers from the planet.</p>
                        <p>Saturn has at least 82 known moons, with Titan being the largest. Titan is larger than Mercury 
                        and has a thick atmosphere, making it one of the most Earth-like worlds in our solar system.</p>
                    `);
                }
            }
        }
        
        // Toggle play/pause
        function togglePlayPause() {
            isPaused = !isPaused;
            document.getElementById('play-pause').textContent = isPaused ? 'Play' : 'Pause';
        }
        
        // Reset view
        function resetView() {
            camera.position.set(0, 50, 100);
            controls.target.set(0, 0, 0);
            controls.update();
        }
        
        // Toggle orbits
        function toggleOrbits() {
            showOrbits = !showOrbits;
            Object.values(orbits).forEach(orbit => {
                orbit.visible = showOrbits;
            });
            document.getElementById('toggle-orbits').classList.toggle('active', showOrbits);
        }
        
        // Toggle labels
        function toggleLabels() {
            showLabels = !showLabels;
            document.getElementById('toggle-labels').classList.toggle('active', showLabels);
        }
        
        // Toggle atmospheres
        function toggleAtmospheres() {
            showAtmospheres = !showAtmospheres;
            document.getElementById('toggle-atmospheres').classList.toggle('active', showAtmospheres);
            
            // Toggle atmosphere visibility
            Object.keys(celestialBodies).forEach(key => {
                const data = celestialData[key];
                if (data.hasAtmosphere && celestialBodies[key].mesh) {
                    celestialBodies[key].mesh.children.forEach(child => {
                        if (child.material && child.material.transparent && child.material.opacity < 0.5) {
                            child.visible = showAtmospheres;
                        }
                    });
                }
            });
        }
        
        // Toggle starfield
        function toggleStars() {
            showStars = !showStars;
            if (stars) {
                stars.visible = showStars;
            }
            document.getElementById('toggle-stars').classList.toggle('active', showStars);
        }
        
        // Toggle distance tool
        function toggleDistanceTool() {
            distanceMode = !distanceMode;
            document.getElementById('distance-tool').classList.toggle('active', distanceMode);
            document.getElementById('distance-measure').classList.toggle('active', distanceMode);
            
            if (!distanceMode) {
                clearDistance();
            }
        }
        
        // Toggle explore mode
        function toggleExploreMode() {
            exploreMode = !exploreMode;
            document.getElementById('explore-mode').classList.toggle('active', exploreMode);
            
            if (exploreMode) {
                controls.minDistance = 2;
                controls.maxDistance = 50;
                showEducationalOverlay('Explore Mode', `
                    <p>Explore Mode is now active! You can get much closer to celestial bodies to examine them in detail.</p>
                    <p>Use your mouse to navigate around planets and moons. Notice the surface features and atmospheric effects.</p>
                    <p>This mode is perfect for studying planetary characteristics up close.</p>
                `);
            } else {
                controls.minDistance = 10;
                controls.maxDistance = 500;
                resetView();
            }
        }
        
        // Toggle celestial selector
        function toggleCelestialSelector() {
            const selector = document.getElementById('celestial-selector');
            selector.classList.toggle('hidden');
        }
        
        // Clear distance measurement
        function clearDistance() {
            selectedBodies = [];
            document.getElementById('distance-result').textContent = '';
        }
        
        // Calculate distance between two selected bodies
        function calculateDistance() {
            if (selectedBodies.length !== 2) return;
            
            const body1 = selectedBodies[0];
            const body2 = selectedBodies[1];
            
            const pos1 = new THREE.Vector3();
            const pos2 = new THREE.Vector3();
            
            body1.getWorldPosition(pos1);
            body2.getWorldPosition(pos2);
            
            const distance = pos1.distanceTo(pos2);
            
            // Convert to "real" distance based on scale
            // This is a simplified conversion for demonstration
            let realDistance;
            const body1Type = body1.userData.type;
            const body2Type = body2.userData.type;
            
            if (body1Type === 'sun' || body2Type === 'sun') {
                // Distance from sun
                const planetType = body1Type === 'sun' ? body2Type : body1Type;
                realDistance = celestialData[planetType].distance * 5 + " million km";
            } else if ((body1Type === 'earth' && body2Type === 'moon') || 
                      (body1Type === 'moon' && body2Type === 'earth')) {
                realDistance = "384,400 km";
            } else {
                // Between planets
                realDistance = "Varies based on orbital positions";
            }
            
            document.getElementById('distance-result').textContent = 
                `Distance between ${body1.userData.data.name} and ${body2.userData.data.name}: ${realDistance}`;
            
            // Show educational overlay about distances
            showEducationalOverlay('Planetary Distances', `
                <p>The distances between celestial bodies in our solar system are enormous.</p>
                <p>The distance from the Earth to the Sun is called an Astronomical Unit (AU), which is about 149.6 million kilometers.</p>
                <p>Light from the Sun takes about 8 minutes to reach Earth.</p>
                <p>The distances between planets constantly change as they orbit the Sun at different speeds.</p>
                <p>At their closest, Mars is about 54.6 million km from Earth, but at their farthest, they can be over 400 million km apart!</p>
            `);
        }
        
        // Update simulation speed
        function updateSimulationSpeed() {
            const slider = document.getElementById('speed-slider');
            simulationSpeed = parseFloat(slider.value);
            document.getElementById('speed-value').textContent = simulationSpeed.toFixed(1);
        }
        
        // Show educational overlay
        function showEducationalOverlay(title, content) {
            document.getElementById('overlay-title').textContent = title;
            document.getElementById('overlay-content').innerHTML = content;
            document.getElementById('educational-overlay').classList.add('active');
        }
        
        // Close educational overlay
        function closeEducationalOverlay() {
            document.getElementById('educational-overlay').classList.remove('active');
        }
        
        // Initialize the application
        init();
    </script>
</body>
</html>